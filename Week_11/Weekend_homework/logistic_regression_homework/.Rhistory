library(tidyverse)
library(janitor)
library(modelr)
library(readxl)
library(GGally)
library(pROC)
juice <- read_csv("data/orange_juice.csv") %>% clean_names()
juice
juice(head)
head(juice)
library(skimr)
skim(juice)
juice %>%
mutate(purchase_mm = if_else(purchase == "MM", TRUE, FALSE))
juice %>%
mutate(purchase_mm = if_else(purchase == "MM", TRUE, FALSE)) %>%
mutate(across(where(is.character)) ~ factor)
juice %>%
mutate(purchase_mm = if_else(purchase == "MM", TRUE, FALSE)) %>%
mutate(across(where(is.character)), .fns = as.factor)
juice %>%
mutate(purchase_mm = if_else(purchase == "MM", TRUE, FALSE)) %>%
mutate(across(where(is.character)), as.factor)
juice %>%
mutate(purchase_mm = if_else(purchase == "MM", TRUE, FALSE)) %>%
mutate(across(where(is_character)), as_factor)
juice %>%
mutate(purchase_mm = if_else(purchase == "MM", TRUE, FALSE)) %>%
mutate(across(where(is_character), as_factor))
juice %>% distinct(weekof_purchase)
juice %>%
distinct(weekof_purchase) %>%
arrange(weekof_purchase)
juice %>%
mutate(quarter = case_when(
weekof_purchase <= 239, ~ "Q1".
juice %>%
mutate(quarter = case_when(
weekof_purchase <= 239, ~ "Q1",
TRUE ~ weekof_purchase
))
juice %>%
mutate(quarter = case_when(
weekof_purchase <= 239 ~ "Q1",
TRUE ~ weekof_purchase
))
juice %>%
mutate(quarter = case_when(
weekof_purchase <= 239 ~ "Q1",
TRUE ~ "weekof_purchase"
))
juice %>%
distinct(weekof_purchase) %>%
arrange(weekof_purchase)
juice %>%
mutate(purchase_mm = if_else(purchase == "MM", TRUE, FALSE)) %>%
mutate(quarter = case_when(
weekof_purchase <= 239 ~ "Q1",
weekof_purchase <= 252 ~ "Q2",
weekof_purchase <= 265 ~ "Q3",
weekof_purchase <= 278 ~ "Q4"
)) %>%
mutate(across(where(is_character), as_factor))
juice <- juice %>%
mutate(purchase_mm = if_else(purchase == "MM", TRUE, FALSE)) %>%
mutate(quarter = case_when(
weekof_purchase <= 239 ~ "Q1",
weekof_purchase <= 252 ~ "Q2",
weekof_purchase <= 265 ~ "Q3",
weekof_purchase <= 278 ~ "Q4"
)) %>%
mutate(across(where(is_character), as_factor)) %>%
select(-c(purchase, weekof_purchase))
alias(purchase_mm ~ .,
data = juice)
juice
juice
juice <- juice %>%
mutate(purchase_mm = if_else(purchase == "MM", TRUE, FALSE)) %>%
mutate(quarter = case_when(
weekof_purchase <= 239 ~ "Q1",
weekof_purchase <= 252 ~ "Q2",
weekof_purchase <= 265 ~ "Q3",
weekof_purchase <= 278 ~ "Q4"
)) %>%
mutate(across(where(is_character), as_factor)) %>%
select(-c(purchase, weekof_purchase, store_id))
juice <- read_csv("data/orange_juice.csv") %>% clean_names()
juice <- juice %>%
mutate(purchase_mm = if_else(purchase == "MM", TRUE, FALSE)) %>%
mutate(quarter = case_when(
weekof_purchase <= 239 ~ "Q1",
weekof_purchase <= 252 ~ "Q2",
weekof_purchase <= 265 ~ "Q3",
weekof_purchase <= 278 ~ "Q4"
)) %>%
mutate(across(where(is_character), as_factor)) %>%
select(-c(purchase, weekof_purchase, store_id))
juice %>%
select(-c(price_diff, list_price_diff, store7)) %>%
alias(purchase_mm ~ .,
data = juice)
juice <- juice %>%
select(-c(price_diff, list_price_diff, store7))
alias(purchase_mm ~ .,
data = juice)
juice <- juice %>%
select(-c(price_diff, list_price_diff, store7, disc_ch, disc_mm))
juice <- read_csv("data/orange_juice.csv") %>% clean_names()
juice <- juice %>%
mutate(purchase_mm = if_else(purchase == "MM", TRUE, FALSE)) %>%
mutate(quarter = case_when(
weekof_purchase <= 239 ~ "Q1",
weekof_purchase <= 252 ~ "Q2",
weekof_purchase <= 265 ~ "Q3",
weekof_purchase <= 278 ~ "Q4"
)) %>%
mutate(across(where(is_character), as_factor)) %>%
select(-c(purchase, weekof_purchase, store_id))
juice <- juice %>%
select(-c(price_diff, list_price_diff, store7, disc_ch, disc_mm))
alias(purchase_mm ~ .,
data = juice)
juice %>% glance()
juice %>% skim()
juice
juice %>% skim()
juice
juice %>% skim()
juice
split1 <- juice %>%
select(price_ch:loyal_ch, purchase_mm) %>%
select(purchase_mm, everything())
split2 <- juice %>%
select(sale_price_mm:store, purchase_mm) %>%
select(purchase_mm, everything())
split3 <- juice %>%
select(purchase_mm, quarter)
split1 %>%
ggpairs()
split2 %>%
ggpairs()
split3 %>%
ggpairs()
n_data <- nrow(juice)
n_data
n_data <- nrow(juice)
test_index <- sample(1:n_data, size = 0.2 * n_data)
test_index
n_data <- nrow(juice)
test_index <- sample(1:n_data, size = 0.2 * n_data)
juice_test <- slice(juice, test_index)
juice_train <- slice(juice, -test_index)
juice_test
juice_train
library(glmulti)
glmulti_search_all_mains <- glmulti(
purchase_mm ~ .,
data = juice_train,
level = 1,
method = "h",
crit = "bic",
confsetsize = 10,
plotty = FALSE,
report = TRUE,
fitfunction = "glm",
family = binomial(link = "logit")
)
summary(glmulti_search_all_mains)
summary(glmulti_search_all_mains)
glmulti_search_previous_mains_one_pair <- glmulti(
purchase_mm ~ loyal_ch + sale_price_mm + sale_price_ch,
data = juice_train,
level = 2,
method = "h",
crit = "bic",
confsetsize = 10,
marginality = TRUE,
minsize = 6,
maxsize = 6,
plotty = FALSE,
report = TRUE,
fitfunction = "glm",
family = binomial(link = "logit")
)
summary(glmulti_search_previous_mains_one_pair)
juice_train
glmulti_search_all_mains <- glmulti(
purchase_mm ~ .,
data = juice_train,
level = 1,
method = "h",
crit = "bic",
confsetsize = 10,
plotty = FALSE,
report = TRUE,
fitfunction = "glm",
family = binomial(link = "logit")
)
mod_glm <- glm(purchase_mm ~ loyal_ch + sale_price_mm + sale_price_ch,
data = juice_train,
family = binomial(link = "logit"))
summary(mod_glm)
summary(glmulti_search_all_mains)
library(tidyverse)
library(janitor)
library(modelr)
library(readxl)
library(GGally)
library(pROC)
juice <- read_csv("data/orange_juice.csv") %>% clean_names()
juice <- juice %>%
mutate(purchase_mm = if_else(purchase == "MM", TRUE, FALSE)) %>% # change to logical
mutate(quarter = case_when(
weekof_purchase <= 239 ~ "Q1", # deal with weekof_purchase column
weekof_purchase <= 252 ~ "Q2",
weekof_purchase <= 265 ~ "Q3",
weekof_purchase <= 278 ~ "Q4"
)) %>%
mutate(across(where(is_character), as_factor)) %>% # change characters to factors
select(-c(purchase, weekof_purchase, store_id)) # drop columns not required
alias(purchase_mm ~ .,
data = juice)
juice <- juice %>%
select(-c(price_diff, list_price_diff, sale_price_mm, sale_price_ch)) # drop more columns due to aliases
alias(purchase_mm ~ .,
data = juice)
split1 <- juice %>%
select(price_ch:loyal_ch, purchase_mm) %>%
select(purchase_mm, everything())
split2 <- juice %>%
select(sale_price_mm:store, purchase_mm) %>%
select(purchase_mm, everything())
juice
split1 <- juice %>%
select(price_ch:special_ch, purchase_mm) %>%
select(purchase_mm, everything())
split2 <- juice %>%
select(special_mm:store, purchase_mm) %>%
select(purchase_mm, everything())
split3 <- juice %>%
select(purchase_mm, quarter)
n_data <- nrow(juice)
test_index <- sample(1:n_data, size = 0.2 * n_data)
juice_test <- slice(juice, test_index)
juice_train <- slice(juice, -test_index)
glmulti_search_all_mains <- glmulti(
purchase_mm ~ .,
data = juice_train,
level = 1,
method = "h",
crit = "bic",
confsetsize = 10,
plotty = FALSE,
report = TRUE,
fitfunction = "glm",
family = binomial(link = "logit")
)
library(glmulti)
glmulti_search_all_mains <- glmulti(
purchase_mm ~ .,
data = juice_train,
level = 1,
method = "h",
crit = "bic",
confsetsize = 10,
plotty = FALSE,
report = TRUE,
fitfunction = "glm",
family = binomial(link = "logit")
)
summary(glmulti_search_all_mains)
mod_glm <- glm(purchase_mm ~ store7 + price_mm + disc_mm + loyal_ch,
data = juice_train,
family = binomial(link = "logit"))
summary(mod_glm)
glmulti_search_previous_mains_one_pair <- glmulti(
purchase_mm ~ store7 + price_mm + disc_mm + loyal_ch,
data = juice_train,
level = 2,
method = "h",
crit = "bic",
confsetsize = 10,
marginality = TRUE,
minsize = 6,
maxsize = 6,
plotty = FALSE,
report = TRUE,
fitfunction = "glm",
family = binomial(link = "logit")
)
summary(glmulti_search_previous_mains_one_pair)
glmulti_search_previous_mains_one_pair <- glmulti(
purchase_mm ~ store7 + price_mm + disc_mm + loyal_ch,
data = juice_train,
level = 2,
method = "h",
crit = "bic",
confsetsize = 10,
marginality = TRUE,
minsize = 5,
maxsize = 6,
plotty = FALSE,
report = TRUE,
fitfunction = "glm",
family = binomial(link = "logit")
)
