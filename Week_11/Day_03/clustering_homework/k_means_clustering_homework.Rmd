---
title: "R Notebook"
output: html_notebook
---

```{r}
library(tidyverse)
library(broom)
library(factoextra)
library(GGally)
```


```{r}
mall <- read_csv("data/mall_customers.csv") %>% janitor::clean_names()
```


```{r}
mall_target <- mall %>% 
  select(annual_income_k, spending_score_1_100)
```


```{r}
mall_target %>% 
  ggplot(aes(x = annual_income_k,
             y = spending_score_1_100))+
  geom_point()
```
findings:

* low annual income, low spending score group
* low annual income, high spending score group
* middle annual income, middle spending score group
* high annual income, low spending score group
* high annual income, high spending score group

k-means clustering

```{r}
max_k <- 20

k_clusters <- tibble(k = 1:max_k) %>% 
  mutate(
    kclust = map(k, ~ kmeans(mall_target, .x, nstart = 25)),
    tidied = map(kclust, tidy),
    glanced = map(kclust, glance),
    augmented = map(kclust, augment, mall_target)
  )
```


```{r}
clusterings_target <- k_clusters %>% 
  unnest(glanced)
```

Elbow
```{r}
clusterings_target %>% 
  ggplot(aes(x = k,
             y = tot.withinss)) +
  geom_point() + 
  geom_line() +
  scale_x_continuous(breaks = seq(1, 20, 1))
```

Observations:

* Elbow looks to be at k = 5


Silhouetting
```{r}
library(factoextra)

fviz_nbclust(mall_target,
             kmeans,
             method = "silhouette",
             nstart = 25)
```

Observations:

* optimal number of clusters is given as 5
* same as the elbow point from the plot above

Gap Statistic
```{r}
fviz_nbclust(mall_target,
             kmeans,
             method = "gap_stat",
             nstart = 25)
```

Observations:

* optimal number of clusterings is given as 1
* not in agreement with first 2 plots


```{r}
clusterings_target %>% 
  unnest(cols = c(augmented)) %>% 
  filter(k <= 5) %>% 
  ggplot(aes(x = annual_income_k,
             y = spending_score_1_100)) + 
  geom_point(aes(colour = .cluster)) +
  facet_wrap(~ k)
```

Observations:

* cluster k = 5 visually looks to be the best split

Extract the means
```{r}
clusterings_target %>% 
  unnest(augmented) %>% 
  filter(k == 5) %>% 
  group_by(.cluster) %>% 
  summarise(mean(annual_income_k),
            mean(spending_score_1_100))
```

Observations

* k==3 and k==4 have a very similar mean annual income
* k==2 and k==5 have a very similar mean annual income
* k==2 and k==4 have a very similar mean spending score
* k==3 and k==5 have a very similar mean spending score
* none of the clusters have similar means for both variables

Results:

* clustering seems to be a good fit
* 2/3 of the plots show k = 5 to be the optimal number of clusterings
* the facet-wrap plot also shows that k = 5 is a good choice
* comparing the means backs this up too

Labels:

* cluster 1: Steadyeddie
* cluster 2: Big Spenders
* cluster 3: Survivors
* cluster 4: Champagne Lifestyle, Lemonade Budget
* cluster 5: Frugal

