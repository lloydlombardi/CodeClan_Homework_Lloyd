str_detect(region, "Indianapolis") ~ "Great Lakes",
str_detect(region, "Jacksonville") ~ "Southeast",
str_detect(region, "LasVegas") ~ "West",
str_detect(region, "LosAngeles") ~ "California",
str_detect(region, "Louisville") ~ "Midsouth",
str_detect(region, "MiamiFtLauderdale") ~ "Southeast",
str_detect(region, "Midsouth") ~ "Midsouth",
str_detect(region, "Nashville") ~ "Midsouth",
str_detect(region, "NewOrleansMobile") ~ "South Central",
str_detect(region, "NewYork") ~ "Northeast",
str_detect(region, "Northeast") ~ "Northeast",
str_detect(region, "NorthernNewEngland") ~ "Northeast",
str_detect(region, "Orlando") ~ "Southeast",
str_detect(region, "Philadelphia") ~ "Northeast",
str_detect(region, "PhoenixTucson") ~ "West",
str_detect(region, "Pittsburgh") ~ "Northeast",
str_detect(region, "Plains") ~ "Plains",
str_detect(region, "Portland") ~ "West",
str_detect(region, "RaleighGreensboro") ~ "Midsouth",
str_detect(region, "RichmondNorfolk") ~ "Midsouth",
str_detect(region, "Roanoke") ~ "Midsouth",
str_detect(region, "Sacramento") ~ "California",
str_detect(region, "SanDiego") ~ "California",
str_detect(region, "SanFrancisco") ~ "California",
str_detect(region, "Seattle") ~ "West",
str_detect(region, "SouthCarolina") ~ "Southeast",
str_detect(region, "SouthCentral") ~ "South Central",
str_detect(region, "Southeast") ~ "Southeast",
str_detect(region, "Spokane") ~ "West",
str_detect(region, "StLouis") ~ "Plains",
str_detect(region, "Syracuse") ~ "Northeast",
str_detect(region, "Tampa") ~ "Southeast",
str_detect(region, "TotalUS") ~ "TotalUS",
str_detect(region, "West") ~ "West",
str_detect(region, "WestTexNewMexico") ~ "South Central",
TRUE ~ region
)) %>%
mutate(is_organic = type == "organic")
avocado <- avocado %>%
select(average_price, total_single, total_bags, type, year, region, month)
avocado %>%
select(average_price, everything()) %>%
ggpairs()
avocado %>%
mutate(ln_total_single = log(total_single),
ln_total_bags = log(total_bags),
prop_single_bags = total_single / (total_single + total_bags),
ln_prop_single_bags = log(prop_single_bags))
avocado <- avocado %>%
mutate(ln_total_single = log(total_single),
ln_total_bags = log(total_bags),
prop_single_bags = total_single / (total_single + total_bags))
avocado %>%
select(average_price, everything()) %>%
ggpairs()
avocado
avocado <- read_csv("data/avocado.csv") %>% janitor::clean_names()
avocado <- avocado %>%
mutate(month = month(date, label = TRUE, abbr = FALSE)) %>%
mutate(total_single = x4046 + x4225 + x4770,
.after = total_volume) %>%
mutate(year = as.factor(year)) %>%
mutate(region = case_when(
str_detect(region, "Albany") ~ "Northeast",
str_detect(region, "Atlanta") ~ "Southeast",
str_detect(region, "BaltimoreWashington") ~ "Northeast",
str_detect(region, "Boise") ~ "West",
str_detect(region, "Boston") ~ "Northeast",
str_detect(region, "BuffaloRochester") ~ "Northeast",
str_detect(region, "California") ~ "California",
str_detect(region, "Charlotte") ~ "Midsouth",
str_detect(region, "Chicago") ~ "Great Lakes",
str_detect(region, "CincinnatiDayton") ~ "Great Lakes",
str_detect(region, "Columbus") ~ "Great Lakes",
str_detect(region, "DallasFtWorth") ~ "South Central",
str_detect(region, "Denver") ~ "West",
str_detect(region, "Detroit") ~ "Great Lakes",
str_detect(region, "GrandRapids") ~ "Great Lakes",
str_detect(region, "GreatLakes") ~ "Great Lakes",
str_detect(region, "HarrisburgScranton") ~ "Northeast",
str_detect(region, "Houston") ~ "South Central",
str_detect(region, "HartfordSpringfield") ~ "Northeast",
str_detect(region, "Indianapolis") ~ "Great Lakes",
str_detect(region, "Jacksonville") ~ "Southeast",
str_detect(region, "LasVegas") ~ "West",
str_detect(region, "LosAngeles") ~ "California",
str_detect(region, "Louisville") ~ "Midsouth",
str_detect(region, "MiamiFtLauderdale") ~ "Southeast",
str_detect(region, "Midsouth") ~ "Midsouth",
str_detect(region, "Nashville") ~ "Midsouth",
str_detect(region, "NewOrleansMobile") ~ "South Central",
str_detect(region, "NewYork") ~ "Northeast",
str_detect(region, "Northeast") ~ "Northeast",
str_detect(region, "NorthernNewEngland") ~ "Northeast",
str_detect(region, "Orlando") ~ "Southeast",
str_detect(region, "Philadelphia") ~ "Northeast",
str_detect(region, "PhoenixTucson") ~ "West",
str_detect(region, "Pittsburgh") ~ "Northeast",
str_detect(region, "Plains") ~ "Plains",
str_detect(region, "Portland") ~ "West",
str_detect(region, "RaleighGreensboro") ~ "Midsouth",
str_detect(region, "RichmondNorfolk") ~ "Midsouth",
str_detect(region, "Roanoke") ~ "Midsouth",
str_detect(region, "Sacramento") ~ "California",
str_detect(region, "SanDiego") ~ "California",
str_detect(region, "SanFrancisco") ~ "California",
str_detect(region, "Seattle") ~ "West",
str_detect(region, "SouthCarolina") ~ "Southeast",
str_detect(region, "SouthCentral") ~ "South Central",
str_detect(region, "Southeast") ~ "Southeast",
str_detect(region, "Spokane") ~ "West",
str_detect(region, "StLouis") ~ "Plains",
str_detect(region, "Syracuse") ~ "Northeast",
str_detect(region, "Tampa") ~ "Southeast",
str_detect(region, "TotalUS") ~ "TotalUS",
str_detect(region, "West") ~ "West",
str_detect(region, "WestTexNewMexico") ~ "South Central",
TRUE ~ region
)) %>%
mutate(is_organic = type == "organic")
avocado <- avocado %>%
select(average_price, total_single, total_bags, type, year, region, month)
avocado <- avocado %>%
mutate(ln_total_single = log(total_single),
ln_total_bags = log(total_bags + 1),
prop_single_bags = total_single / (total_single + total_bags))
avocado %>%
select(average_price, everything()) %>%
ggpairs()
avocado %>%
ggplot(aes(x = ln_total_bags))+
geom_histogram()
avocado %>%
ggplot(aes(x = type))+
geom_boxplot()
avocado %>%
ggplot(aes(x = type,
y = average_price))+
geom_boxplot()
mod1a <- lm(average_price ~ ln_total_bags,
data = avocado)
autoplot(mod1a)
summary(mod1a)
mod1b <- lm(average_price ~ type,
data = avocado)
autoplot(mod1b)
summary(type)
summary(mod1b)
avocado
avocado <- read_csv("data/avocado.csv") %>% janitor::clean_names()
avocado <- avocado %>%
mutate(month = month(date, label = TRUE, abbr = FALSE)) %>%
mutate(total_single = x4046 + x4225 + x4770,
.after = total_volume) %>%
mutate(year = as.factor(year)) %>%
mutate(region = case_when(
str_detect(region, "Albany") ~ "Northeast",
str_detect(region, "Atlanta") ~ "Southeast",
str_detect(region, "BaltimoreWashington") ~ "Northeast",
str_detect(region, "Boise") ~ "West",
str_detect(region, "Boston") ~ "Northeast",
str_detect(region, "BuffaloRochester") ~ "Northeast",
str_detect(region, "California") ~ "California",
str_detect(region, "Charlotte") ~ "Midsouth",
str_detect(region, "Chicago") ~ "Great Lakes",
str_detect(region, "CincinnatiDayton") ~ "Great Lakes",
str_detect(region, "Columbus") ~ "Great Lakes",
str_detect(region, "DallasFtWorth") ~ "South Central",
str_detect(region, "Denver") ~ "West",
str_detect(region, "Detroit") ~ "Great Lakes",
str_detect(region, "GrandRapids") ~ "Great Lakes",
str_detect(region, "GreatLakes") ~ "Great Lakes",
str_detect(region, "HarrisburgScranton") ~ "Northeast",
str_detect(region, "Houston") ~ "South Central",
str_detect(region, "HartfordSpringfield") ~ "Northeast",
str_detect(region, "Indianapolis") ~ "Great Lakes",
str_detect(region, "Jacksonville") ~ "Southeast",
str_detect(region, "LasVegas") ~ "West",
str_detect(region, "LosAngeles") ~ "California",
str_detect(region, "Louisville") ~ "Midsouth",
str_detect(region, "MiamiFtLauderdale") ~ "Southeast",
str_detect(region, "Midsouth") ~ "Midsouth",
str_detect(region, "Nashville") ~ "Midsouth",
str_detect(region, "NewOrleansMobile") ~ "South Central",
str_detect(region, "NewYork") ~ "Northeast",
str_detect(region, "Northeast") ~ "Northeast",
str_detect(region, "NorthernNewEngland") ~ "Northeast",
str_detect(region, "Orlando") ~ "Southeast",
str_detect(region, "Philadelphia") ~ "Northeast",
str_detect(region, "PhoenixTucson") ~ "West",
str_detect(region, "Pittsburgh") ~ "Northeast",
str_detect(region, "Plains") ~ "Plains",
str_detect(region, "Portland") ~ "West",
str_detect(region, "RaleighGreensboro") ~ "Midsouth",
str_detect(region, "RichmondNorfolk") ~ "Midsouth",
str_detect(region, "Roanoke") ~ "Midsouth",
str_detect(region, "Sacramento") ~ "California",
str_detect(region, "SanDiego") ~ "California",
str_detect(region, "SanFrancisco") ~ "California",
str_detect(region, "Seattle") ~ "West",
str_detect(region, "SouthCarolina") ~ "Southeast",
str_detect(region, "SouthCentral") ~ "South Central",
str_detect(region, "Southeast") ~ "Southeast",
str_detect(region, "Spokane") ~ "West",
str_detect(region, "StLouis") ~ "Plains",
str_detect(region, "Syracuse") ~ "Northeast",
str_detect(region, "Tampa") ~ "Southeast",
str_detect(region, "TotalUS") ~ "TotalUS",
str_detect(region, "West") ~ "West",
str_detect(region, "WestTexNewMexico") ~ "South Central",
TRUE ~ region
)) %>%
mutate(is_organic = type == "organic")
avocado <- avocado %>%
select(average_price, total_single, total_bags, is_organic, year, region, month)
avocado %>%
select(average_price, everything()) %>%
ggpairs()
avocado <- avocado %>%
mutate(ln_total_single = log(total_single),
ln_total_bags = log(total_bags + 1),
prop_single_bags = total_single / (total_single + total_bags))
avocado %>%
select(average_price, everything()) %>%
ggpairs()
avocado %>%
ggplot(aes(x = is_organic,
y = average_price))+
geom_boxplot()
mod1b <- lm(average_price ~ is_organic,
data = avocado)
mod1b <- lm(average_price ~ is_organic,
data = avocado)
autoplot(mod1b)
summary(mod1b)
avocado_resid <- avocado %>%
add_residuals(mod1b) %>%
select(-c(average_price, is_organic))
avocado_resid %>%
select(resid, everything())
avocado_resid <- avocado %>%
add_residuals(mod1b) %>%
select(-c(average_price, is_organic))
avocado_resid %>%
select(resid, everything()) %>%
ggpairs()
avocado %>%
ggplot(aes(x = region,
y = average_price))+
geom_boxplot()
avocado %>%
ggplot(aes(x = month,
y = average_price))+
geom_boxplot()
mod2a <- lm(average_price ~ is_organic + ln_total_bags,
data = avocado)
autoplot(mod2a)
mod2b <- lm(average_price ~ is_organic + region,
data = avocado)
autoplot(mod2b)
mod2a <- lm(average_price ~ is_organic + month,
data = avocado)
autoplot(mod2a)
mod2a <- lm(average_price ~ is_organic + ln_total_bags,
data = avocado)
autoplot(mod2a)
summary(mod2a)
summary(mod2b)
summary(mod2c)
mod2c <- lm(average_price ~ is_organic + month,
data = avocado)
autoplot(mod2c)
summary(mod2c)
avocado
avocado <- read_csv("data/avocado.csv") %>% janitor::clean_names()
avocado <- avocado %>%
mutate(month = month(date, label = TRUE, abbr = FALSE)) %>%
mutate(total_single = x4046 + x4225 + x4770,
.after = total_volume) %>%
mutate(year = as.factor(year)) %>%
mutate(region = case_when(
str_detect(region, "Albany") ~ "Northeast",
str_detect(region, "Atlanta") ~ "Southeast",
str_detect(region, "BaltimoreWashington") ~ "Northeast",
str_detect(region, "Boise") ~ "West",
str_detect(region, "Boston") ~ "Northeast",
str_detect(region, "BuffaloRochester") ~ "Northeast",
str_detect(region, "California") ~ "California",
str_detect(region, "Charlotte") ~ "Midsouth",
str_detect(region, "Chicago") ~ "Great Lakes",
str_detect(region, "CincinnatiDayton") ~ "Great Lakes",
str_detect(region, "Columbus") ~ "Great Lakes",
str_detect(region, "DallasFtWorth") ~ "South Central",
str_detect(region, "Denver") ~ "West",
str_detect(region, "Detroit") ~ "Great Lakes",
str_detect(region, "GrandRapids") ~ "Great Lakes",
str_detect(region, "GreatLakes") ~ "Great Lakes",
str_detect(region, "HarrisburgScranton") ~ "Northeast",
str_detect(region, "Houston") ~ "South Central",
str_detect(region, "HartfordSpringfield") ~ "Northeast",
str_detect(region, "Indianapolis") ~ "Great Lakes",
str_detect(region, "Jacksonville") ~ "Southeast",
str_detect(region, "LasVegas") ~ "West",
str_detect(region, "LosAngeles") ~ "California",
str_detect(region, "Louisville") ~ "Midsouth",
str_detect(region, "MiamiFtLauderdale") ~ "Southeast",
str_detect(region, "Midsouth") ~ "Midsouth",
str_detect(region, "Nashville") ~ "Midsouth",
str_detect(region, "NewOrleansMobile") ~ "South Central",
str_detect(region, "NewYork") ~ "Northeast",
str_detect(region, "Northeast") ~ "Northeast",
str_detect(region, "NorthernNewEngland") ~ "Northeast",
str_detect(region, "Orlando") ~ "Southeast",
str_detect(region, "Philadelphia") ~ "Northeast",
str_detect(region, "PhoenixTucson") ~ "West",
str_detect(region, "Pittsburgh") ~ "Northeast",
str_detect(region, "Plains") ~ "Plains",
str_detect(region, "Portland") ~ "West",
str_detect(region, "RaleighGreensboro") ~ "Midsouth",
str_detect(region, "RichmondNorfolk") ~ "Midsouth",
str_detect(region, "Roanoke") ~ "Midsouth",
str_detect(region, "Sacramento") ~ "California",
str_detect(region, "SanDiego") ~ "California",
str_detect(region, "SanFrancisco") ~ "California",
str_detect(region, "Seattle") ~ "West",
str_detect(region, "SouthCarolina") ~ "Southeast",
str_detect(region, "SouthCentral") ~ "South Central",
str_detect(region, "Southeast") ~ "Southeast",
str_detect(region, "Spokane") ~ "West",
str_detect(region, "StLouis") ~ "Plains",
str_detect(region, "Syracuse") ~ "Northeast",
str_detect(region, "Tampa") ~ "Southeast",
str_detect(region, "TotalUS") ~ "TotalUS",
str_detect(region, "West") ~ "West",
str_detect(region, "WestTexNewMexico") ~ "South Central",
TRUE ~ region
)) %>%
mutate(is_organic = type == "organic")
avocado <- avocado %>%
select(average_price, total_single, total_bags, is_organic, year, region, month)
avocado <- avocado %>%
mutate(ln_total_single = log(total_single),
ln_total_bags = log(total_bags + 1),
prop_single_bags = total_single / (total_single + total_bags))
n_row <- nrow(avocado)
n_row
test_index <- sample(1:n_row, size = n_row * 0.1)
avocado_test <- slice(avocado, test_index)
avocado_train <- slice(avocado, -test_index)
avocado_train %>%
select(average_price, everything()) %>%
ggpairs()
avocado_train %>%
ggplot(aes(x = ln_total_bags))+
geom_histogram()
avocado_train %>%
ggplot(aes(x = is_organic,
y = average_price))+
geom_boxplot()
mod1a <- lm(average_price ~ ln_total_bags,
data = avocado_train)
autoplot(mod1a)
summary(mod1a)
mod1b <- lm(average_price ~ is_organic,
data = avocado_train)
autoplot(mod1b)
avocado_train
mod1b <- lm(average_price ~ is_organic,
data = avocado_train)
autoplot(mod1b)
summary(mod1b)
avocado_resid <- avocado_train %>%
add_residuals(mod1b) %>%
select(-c(average_price, is_organic))
avocado_resid %>%
select(resid, everything()) %>%
ggpairs()
avocado_train %>%
ggplot(aes(x = region,
y = average_price))+
geom_boxplot()
avocado_train %>%
ggplot(aes(x = month,
y = average_price))+
geom_boxplot()
mod2a <- lm(average_price ~ is_organic + ln_total_bags,
data = avocado_train)
autoplot(mod2a)
summary(mod2a)
mod2b <- lm(average_price ~ is_organic + region,
data = avocado_train)
autoplot(mod2b)
summary(mod2b)
mod2c <- lm(average_price ~ is_organic + month,
data = avocado_train)
autoplot(mod2c)
summary(mod2c)
avocado_resid <- avocado_train %>%
add_residuals(mod2b) %>%
select(-c(average_price, is_organic, region))
avocado_resid %>%
select(resid, everything()) %>%
ggpairs()
avocado_train
avocado_resid <- avocado_train %>%
add_residuals(mod2b) %>%
select(-c(average_price, is_organic, region))
avocado_resid %>%
select(resid, everything()) %>%
ggpairs()
mod3a <- lm(average_price ~ is_organic + region + prop_single_bags,
data = avocado_train)
autoplot(mod3a)
summary(mod3a)
mod3b <- lm(average_price ~ is_organic + region + month,
data = avocado_train)
autoplot(mod3b)
summary(mod3b)
anova(mod2b, mod3b)
avocado_resid <- avocado_train %>%
add_residuals(mod3b) %>%
select(-c(average_price, is_organic, region, month))
avocado_resid %>%
select(resid, everything()) %>%
ggpairs()
mod4a <- lm(average_price ~ is_organic + region + month + prop_single_bags,
data = avocado_train)
autoplot(mod4a)
summary(mod4a)
mod4b <- lm(average_price ~ is_organic + region + month + year,
data = avocado_train)
autoplot(mod4b)
summary(mod4b)
mod4c <- lm(average_price ~ is_organic + region + month + ln_total_bags,
data = avocado_train)
autoplot(mod4c)
summary(mod4c)
library(caret)
anova(mod3b, mod4c)
anova(mod3b, mod4b)
anova(mod3b, mod4a)
anova(mod3b, mod4a)
cv_10_fold <- trainControl(method = "cv",
number = 10,
savePredictions = TRUE)
avo_model <- train(average_price ~ is_organic + region + month + year,
data = avocado_train,
trControl = cv_10_fold,
method = "lm")
avo_model$pred
avo_model$resample
mean(avo_model$resample$Rsquared)
avocado_test %>%
add_predictions(mod4b)
predictions_test
predictions_test <- avocado_test %>%
add_predictions(mod4b) %>%
select(average_price, pred)
predictions_test
predictions_test <- predictions_test %>%
mutate(sq_err = (pred - average_price)^2)
mse_test <- mean(predictions_test$sq_err)
mse_test # normally this would be sqrt'd -> RMSE
sqrt(mse_test)
predictions_train <- avocado_train %>%
add_predictions(mod4b) %>%
select(average_price, pred)
predictions_test
avocado_train %>%
add_predictions(mod4b) %>%
select(average_price, pred)
predictions_train <- avocado_train %>%
add_predictions(mod4b) %>%
select(average_price, pred)
predictions_train
predictions_train <- predictions_train %>%
mutate(sq_err = (pred - savings) ^ 2)
predictions_train <- predictions_train %>%
mutate(sq_err = (pred - average_price) ^ 2)
mse_train <- mean(predictions_train$sq_err)
mse_train
sqrt(mse_train)
sqrt(mean(avo_model$resample$Rsquared))
mean(avo_model$resample$Rsquared)
mean(avo_model$resample$RMSE)
mod3b <- lm(average_price ~ is_organic + region + month,
data = avocado_train)
autoplot(mod3b)
summary(mod3b)
mod3b <- lm(average_price ~ is_organic + region + month,
data = avocado_train)
autoplot(mod3b)
summary(mod3b)
predictions_test <- avocado_test %>%
add_predictions(mod4c) %>%
select(average_price, pred)
predictions_test
predictions_test <- predictions_test %>%
mutate(sq_err = (pred - average_price)^2)
mse_test <- mean(predictions_test$sq_err)
mse_test # normally this would be sqrt'd -> RMSE
sqrt(mse_test)
predictions_train <- avocado_train %>%
add_predictions(mod4c) %>%
select(average_price, pred)
predictions_train
predictions_train <- predictions_train %>%
mutate(sq_err = (pred - average_price) ^ 2)
mse_train <- mean(predictions_train$sq_err)
mse_train
sqrt(mse_train)
avocado
