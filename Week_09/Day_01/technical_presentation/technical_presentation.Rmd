---
title: "Data Analyst Hospital & Health Care"
output: html_notebook
---
Read in the required libraries
```{r, eval=FALSE}
library(tidyverse)
library(janitor)
library(brew)
```

Read in data sets
```{r, eval=FALSE}
incidence <- read_csv("data/incidence_by_hb.csv") %>% clean_names()

hb <- read_csv("data/hb_geography_code.csv") %>% clean_names()
```

Join health-board name column to incidence data
```{r, eval=FALSE}
incidence <- incidence %>% 
  left_join(select(hb, hb_name, hb), by = c("hb" = "hb"), keep = FALSE)
```

Re-code Male only cancer sex type to "All" 
```{r, eval=FALSE}
incidence_male <- incidence %>%
  filter(cancer_site %in% c("Prostate", "Penis", "Testis")) %>% 
  mutate(sex = recode(sex,
                      "Male" = "All"))
```


```{r, eval=FALSE}
incidence <- incidence %>% 
  filter(cancer_site != "Prostate",
         cancer_site != "Penis",
         cancer_site != "Testis")
```



```{r, eval=FALSE}
incidence <- incidence %>% 
  bind_rows(incidence_male)
```


```{r, eval=FALSE}
incidence_female <- incidence %>%
  filter(cancer_site %in% c("Carcinoma in situ of the cervix uteri", "Cervix uteri", "Corpus uteri", "Ovary", "Uterus", "Vagina", "Vulva")) %>% 
  mutate(sex = recode(sex,
                      "Female" = "All"))
```


```{r, eval=FALSE}
incidence <- incidence %>% 
  filter(cancer_site != "Carcinoma in situ of the cervix uteri",
         cancer_site != "Cervix uteri",
         cancer_site != "Corpus uteri",
         cancer_site != "Ovary",
         cancer_site != "Uterus",
         cancer_site != "Vagina",
         cancer_site != "Vulva")
```



```{r, eval=FALSE}
incidence <- incidence %>% 
  bind_rows(incidence_female)
```


> This report will focus on the 4 most common types of cancer, according to the NHS
* #### Bowel Cancer
* #### Breast Cancer
* #### Lung Cancer
* #### Prostate Cancer
8 types of localised cancer sites were grouped together to fully encapsulate the four most common types of cancer

```{r, eval=FALSE}
# Insert a column and only return the Big Four cancer types
nhs_select <- incidence %>% 
  filter(cancer_site %in% c("Breast", "Carcinoma in situ of the breast", "Colon", "Colorectal cancer", "Mesothelioma", "Prostate", "Rectum and rectosigmoid junction", "Trachea, bronchus and lung")) %>% 
  mutate(cancer_common = case_when(
    str_detect(cancer_site, "Breast") ~ "Breast",
    str_detect(cancer_site, "Carcinoma in situ of the breast") ~ "Breast",
    str_detect(cancer_site, "Colon") ~ "Bowel",
    str_detect(cancer_site, "Colorectal cancer") ~ "Bowel",
    str_detect(cancer_site, "Rectum and rectosigmoid junction") ~ "Bowel",
    str_detect(cancer_site, "Prostate") ~ "Prostate",
    str_detect(cancer_site, "Mesothelioma") ~ "Lung",
    str_detect(cancer_site, "Trachea, bronchus and lung") ~ "Lung"
  ), .after = cancer_site)
```



## Plot all cancer types for all sexes in NHS Borders
```{r, echo=FALSE}
incidence %>%
  filter(hb_name == "NHS Borders",
         cancer_site == "All cancer types",
         sex == "All") %>% 
  ggplot(aes(x = year,
             y = incidences_all_ages))+
  geom_point()+
  geom_line(group = 1)+
  geom_smooth()+
  theme_minimal()+
  labs(x = "\nYear",
       y = "Incidence Rate",
       title = "Incidence Rate of All Cancer Sites for All Ages in NHS Borders\n")
```


Filter for only NHS Borders
```{r}
nhs_borders <- nhs_select %>% 
  filter(hb_name == "NHS Borders")
```


Plot Breast cancer incidences for All sex
```{r}
nhs_borders %>%
  filter(cancer_common == "Breast",
         sex == "All") %>%
  group_by(year) %>% 
  summarise(total_incidences_breast = sum(incidences_all_ages)) %>% 
  ggplot(aes(x = year,
             y = total_incidences_breast))+
  geom_point()+
  geom_line()+
  geom_smooth()+
  theme_minimal()+
  labs(x = "\nYear",
       y = "Incidence Rate",
       title = "Incidence Rate of Breast Cancer for All Ages in NHS Borders\n")
```


Plot Bowel cancer incidences for All sex
```{r}
nhs_borders %>%
  filter(cancer_common == "Bowel",
         sex == "All") %>%
  group_by(year) %>% 
  summarise(total_incidences_bowel = sum(incidences_all_ages)) %>% 
  ggplot(aes(x = year,
             y = total_incidences_bowel))+
  geom_point()+
  geom_line()+
  geom_smooth()+
  theme_minimal()+
  labs(x = "\nYear",
       y = "Incidence Rate",
       title = "Incidence Rate of Bowel Cancer for All Ages in NHS Borders\n")
```


Plot Ling cancer incidences for All sex
```{r}
nhs_borders %>%
  filter(cancer_common == "Lung",
         sex == "All") %>%
  group_by(year) %>% 
  summarise(total_incidences_lung = sum(incidences_all_ages)) %>% 
  ggplot(aes(x = year,
             y = total_incidences_lung))+
  geom_point()+
  geom_line()+
  geom_smooth()+
  theme_minimal()+
  labs(x = "\nYear",
       y = "Incidence Rate",
       title = "Incidence Rate of Lung Cancer for All Ages in NHS Borders\n")
```


Plot Prostate cancer incidences for All sex
```{r}
nhs_borders %>%
  filter(cancer_common == "Prostate",
         sex == "All") %>%
  group_by(year) %>% 
  summarise(total_incidences_prostate = sum(incidences_all_ages)) %>% 
  ggplot(aes(x = year,
             y = total_incidences_prostate))+
  geom_point()+
  geom_line()+
  geom_smooth()+
  theme_minimal()+
  labs(x = "\nYear",
       y = "Incidence Rate",
       title = "Incidence Rate of Prostate for All Ages in NHS Borders\n")
```


Plot total incidences of four common cancers for all sex
```{r}
nhs_borders %>% 
  filter(sex == "All") %>% 
  group_by(year) %>% 
  summarise(total_incidies = sum(incidences_all_ages)) %>% 
  ggplot(aes(x = year,
             y = total_incidies))+
  geom_point()+
  geom_line(group = 1)+
  geom_smooth()
```


Plot total incidences for all sex in bar
```{r}
nhs_borders %>% 
  filter(sex == "All") %>% 
  group_by(year) %>% 
  summarise(total_incidies = sum(incidences_all_ages)) %>% 
  ggplot(aes(x = year,
             y = total_incidies))+
  geom_col()+
  geom_smooth()
```


Plot the Big Four cancer types for all sex
```{r}
nhs_borders %>% 
  filter(sex == "All") %>% 
  group_by(year, cancer_common) %>% 
  summarise(total_indicies = sum(incidences_all_ages)) %>% 
  ggplot(aes(x = year,
             y = total_indicies)) +
  geom_point()+
  geom_line(aes(group = cancer_common, colour = cancer_common))
```


Same as above on a horizontal bar
```{r}
nhs_borders %>% 
  filter(sex == "All") %>% 
  group_by(year, cancer_common) %>% 
  summarise(total_indicies = sum(incidences_all_ages)) %>% 
  ggplot(aes(x = year,
             y = total_indicies)) +
  geom_col(aes(fill = cancer_common), position = "stack")+
  coord_flip()
```

```{r}
nhs_borders %>% 
  filter(sex == "All",
         year >= 2015) %>% 
  group_by(cancer_common) %>% 
  summarise(total_indicies = sum(incidences_all_ages)) %>% 
  ggplot(aes(x = cancer_common,
             y = total_indicies))+
  geom_col(aes(fill = cancer_common))+
  theme_minimal()+
  scale_fill_brewer(palette = "Dark2")+
  theme(legend.position = "none")+
  geom_text(aes(label = paste0(round(total_indicies/sum(total_indicies)*100), "%"), vjust = -0.25))+
  labs(x = "\nType of Cancer",
       y = "Incidence Rate",
       title = "Incidence Rate of Common Cancer Types for All Ages in NHS Borders",
       subtitle = "Years: 2015 - 2020\n")
```

```{r}
nhs_select %>% 
  filter(sex == "All",
         year >= 2015) %>% 
  group_by(cancer_common) %>% 
  summarise(total_indicies = sum(incidences_all_ages)) %>% 
  ggplot(aes(x = cancer_common,
             y = total_indicies))+
  geom_col(aes(fill = cancer_common))+
  theme_minimal()+
  scale_fill_brewer(palette = "Dark2")+
  theme(legend.position = "none")+
  geom_text(aes(label = paste0(round(total_indicies/sum(total_indicies)*100, digits = 1), "%"), vjust = -0.25))+
  labs(x = "\nType of Cancer",
       y = "Incidence Rate",
       title = "Incidence Rate of Common Cancer Types for All Ages in NHS Scotland",
       subtitle = "Years: 2015 - 2020\n") 
```



```{r}
all_scotland <- read_csv("data/all_scotland.csv") %>% clean_names()
```

```{r}
scotland_male <- all_scotland %>%
  filter(cancer_site %in% c("Prostate", "Penis", "Testis")) %>% 
  mutate(sex = recode(sex,
                      "Male" = "All"))
```


```{r}
all_scotland <- all_scotland %>% 
  filter(cancer_site != "Prostate",
         cancer_site != "Penis",
         cancer_site != "Testis")
```



```{r}
all_scotland <- all_scotland %>% 
  bind_rows(scotland_male)
```


```{r}
scotland_female <- all_scotland %>%
  filter(cancer_site %in% c("Carcinoma in situ of the cervix uteri", "Cervix uteri", "Corpus uteri", "Ovary", "Uterus", "Vagina", "Vulva")) %>% 
  mutate(sex = recode(sex,
                      "Female" = "All"))
```


```{r}
all_scotland <- all_scotland %>% 
  filter(cancer_site != "Carcinoma in situ of the cervix uteri",
         cancer_site != "Cervix uteri",
         cancer_site != "Corpus uteri",
         cancer_site != "Ovary",
         cancer_site != "Uterus",
         cancer_site != "Vagina",
         cancer_site != "Vulva")
```



```{r}
all_scotland <- all_scotland %>% 
  bind_rows(scotland_female)
```


```{r}
scotland_select <- all_scotland %>% 
  filter(cancer_site %in% c("Breast", "Carcinoma in situ of the breast", "Colon", "Colorectal cancer", "Mesothelioma", "Prostate", "Rectum and rectosigmoid junction", "Trachea, bronchus and lung")) %>% 
  mutate(cancer_common = case_when(
    str_detect(cancer_site, "Breast") ~ "Breast",
    str_detect(cancer_site, "Carcinoma in situ of the breast") ~ "Breast",
    str_detect(cancer_site, "Colon") ~ "Bowel",
    str_detect(cancer_site, "Colorectal cancer") ~ "Bowel",
    str_detect(cancer_site, "Rectum and rectosigmoid junction") ~ "Bowel",
    str_detect(cancer_site, "Prostate") ~ "Prostate",
    str_detect(cancer_site, "Mesothelioma") ~ "Lung",
    str_detect(cancer_site, "Trachea, bronchus and lung") ~ "Lung"
  ), .after = cancer_site)
```





```{r}
all_scotland %>%
  filter(cancer_site == "All cancer types",
         sex == "All") %>% 
  ggplot(aes(x = year,
             y = incidences_all_ages))+
  geom_point()+
  geom_line(group = 1)+
  geom_smooth()+
  theme_minimal()+
  labs(x = "\nYear",
       y = "Incidence Rate",
       title = "Incidence Rate of All Cancer Sites for All Ages across NHS Scotland\n")
```




